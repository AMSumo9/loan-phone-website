<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>{{ page.title }} | The Loan Phone Blog</title>
    <meta name="description" content="{{ page.meta_description | default: page.excerpt | strip_html | truncatewords: 30 }}">
    <meta name="keywords" content="{{ page.meta_keywords | default: site.seo.default_keywords }}">
    <meta name="author" content="{{ page.author | default: 'The Loan Phone Team' }}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title }} | The Loan Phone Blog">
    <meta property="og:description" content="{{ page.meta_description | default: page.excerpt | strip_html | truncatewords: 30 }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta property="og:image" content="{{ site.url }}{{ site.baseurl }}/assets/images/blog/{{ page.featured_image | default: 'default-blog.jpg' }}">
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
    {% if page.author %}<meta property="article:author" content="{{ page.author }}">{% endif %}
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title }} | The Loan Phone Blog">
    <meta name="twitter:description" content="{{ page.meta_description | default: page.excerpt | strip_html | truncatewords: 30 }}">
    <meta name="twitter:image" content="{{ site.url }}{{ site.baseurl }}/assets/images/blog/{{ page.featured_image | default: 'default-blog.jpg' }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicon.ico">
    
    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FIXED: Dark Mode CSS - Copied from working default.html -->
    <style>
        :root { 
            --bg-primary: #ffffff; 
            --bg-secondary: #f9fafb; 
            --bg-accent: #fce8e8; 
            --text-primary: #1f2937; 
            --text-secondary: #4b5563; 
            --brand-red: #DC2626; 
            --brand-red-dark: #B91C1C; 
        }
        html.dark { 
            --bg-primary: #1f2937; 
            --bg-secondary: #374151; 
            --bg-accent: #374151; 
            --text-primary: #f9fafb; 
            --text-secondary: #d1d5db; 
        }
        
        /* FIXED: Dark mode contrast issues */
        html.dark .features-heading, 
        html.dark .features-benefits-section h3,
        html.dark .privacy-content h2,
        html.dark .privacy-content h3,
        html.dark h1,
        html.dark h2, 
        html.dark h3,
        html.dark h4,
        html.dark h5,
        html.dark h6 { 
            color: #ffffff !important; 
        }
        
        /* FIXED: Dark mode text colors */
        html.dark .text-gray-800 {
            color: #f9fafb !important;
        }
        
        html.dark .text-gray-700 {
            color: #d1d5db !important;
        }
        
        html.dark .text-gray-600 {
            color: #9ca3af !important;
        }
        
        /* FIXED: Dark mode backgrounds */
        html.dark .bg-white {
            background-color: #374151 !important;
        }
        
        html.dark .bg-gray-50 {
            background-color: #4b5563 !important;
        }
        
        /* Keep brand red visible in dark mode */
        html.dark .brand-red {
            color: #ef4444 !important;
        }
        
        body { 
            font-family: 'Open Sans', sans-serif; 
            background-color: var(--bg-primary); 
            color: var(--text-primary); 
            line-height: 1.7;
            transition: background-color 0.3s, color 0.3s; 
        }
        h1, h2, h3, h4, h5, h6 { 
            font-family: 'Poppins', sans-serif; 
            font-weight: 600;
            color: var(--text-primary);
        }
        .brand-red { 
            color: var(--brand-red) !important; 
        }
        .bg-brand-red { 
            background-color: var(--brand-red) !important; 
        }
        .hover\:bg-brand-red-dark:hover { 
            background-color: var(--brand-red-dark) !important; 
        }
        
        /* Blog content styling */
        .blog-content {
            font-size: 18px;
            line-height: 1.8;
        }
        .blog-content h1 { font-size: 2.5rem; margin: 2rem 0 1rem 0; clear: left; }
        .blog-content h2 { font-size: 2rem; margin: 2rem 0 1rem 0; clear: left; }
        .blog-content h3 { font-size: 1.5rem; margin: 1.5rem 0 1rem 0; clear: left; }
        .blog-content h4 { font-size: 1.25rem; margin: 1.5rem 0 1rem 0; clear: left; }
        .blog-content p { margin-bottom: 1.5rem; }
        .blog-content ul, .blog-content ol { 
            margin-bottom: 1.5rem; 
            padding-left: 2rem; 
        }
        .blog-content li { margin-bottom: 0.5rem; }
        .blog-content blockquote {
            border-left: 4px solid var(--brand-red);
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            color: var(--text-secondary);
        }
        .blog-content a {
            color: var(--brand-red);
            text-decoration: underline;
        }
        .blog-content a:hover {
            color: var(--brand-red-dark);
        }
        
        /* Featured image float styling */
        .featured-image-float {
            float: left;
            margin: 0 2rem 1rem 0;
            width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .featured-image-float {
                float: none;
                width: 100%;
                height: 200px;
                margin: 0 0 1.5rem 0;
            }
            .desktop-sidebar {
                order: -1;
                margin-bottom: 2rem;
            }
        }
        
        #back-to-top { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            opacity: 0; 
            visibility: hidden; 
            transform: translateY(20px); 
            transition: all 0.3s; 
            z-index: 100; 
        }
        #back-to-top.active { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
        }
    </style>
</head>
<body class="bg-white text-gray-800">

    <!-- Header -->
    {% include header.html %}
    
    <main>
        <!-- Blog Post Header (Pink Section) - ALWAYS light pink with dark text -->
        <section class="blog-header py-16" style="background-color: #fce8e8;">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto text-center">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">{{ page.title }}</h1>
                    
                    <!-- LINE 1: Date, Author, Time to Read -->
                    <div class="flex flex-wrap justify-center items-center gap-4 text-gray-600 mb-4">
                        <span class="flex items-center">
                            <i class="fas fa-calendar mr-2"></i>
                            {{ page.date | date: "%B %d, %Y" }}
                        </span>
                        {% if page.author %}
                        <span class="flex items-center">
                            <i class="fas fa-user mr-2"></i>
                            {{ page.author }}
                        </span>
                        {% endif %}
                        {% if page.read_time %}
                        <span class="flex items-center">
                            <i class="fas fa-clock mr-2"></i>
                            {{ page.read_time }} min read
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- LINE 2: Tags -->
                    {% if page.category or page.tags %}
                    <div class="flex flex-wrap justify-center items-center gap-2 mb-4">
                        {% if page.category %}
                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">
                            {{ page.category }}
                        </span>
                        {% endif %}
                        {% if page.tags %}
                        {% for tag in page.tags %}
                        <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">
                            {{ tag }}
                        </span>
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- LINE 3: Breadcrumbs -->
                    <nav class="text-gray-600 text-sm">
                        <a href="{{ site.baseurl }}/" class="hover:text-red-600">Home</a>
                        <span class="mx-2">></span>
                        <a href="{{ site.baseurl }}/blog/" class="hover:text-red-600">Blog</a>
                        <span class="mx-2">></span>
                        <span class="text-gray-800">{{ page.title }}</span>
                    </nav>
                </div>
            </div>
        </section>
        
        <!-- Blog Content with Sidebar Layout -->
        <section class="py-8 bg-[var(--bg-primary)] transition-colors duration-300">
            <div class="container mx-auto px-6">
                <div class="max-w-6xl mx-auto">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Main Content Area -->
                        <article class="lg:w-2/3 blog-content">
                            <!-- Opening Subheading -->
                            <h2 class="text-[var(--text-primary)]">{{ page.title | remove: "Tips to" | remove: "How to" | prepend: "Understanding " }}</h2>
                            
                            <!-- Introduction Text Above Image -->
                            <div class="mb-6">
                                <p class="text-lg text-[var(--text-secondary)] leading-relaxed">{{ page.excerpt | default: "Your credit score is one of the most important factors lenders consider when evaluating your loan application. A higher score can mean the difference between getting approved at a great rate or being turned down altogether." }}</p>
                            </div>
                            
                            <!-- Featured Image (Float Left, Smaller) -->
                            {% if page.featured_image %}
                            <img src="{{ site.baseurl }}/assets/images/blog/{{ page.featured_image }}" 
                                 alt="{{ page.title }}" 
                                 class="featured-image-float">
                            {% endif %}
                            
                            <!-- Blog Content -->
                            {{ content }}
                            
                            <!-- Clear floats -->
                            <div style="clear: both;"></div>
                            
                            <!-- Share Section - FIXED: Better contrast in dark mode -->
                            <div class="mt-8 pt-8 border-t border-gray-200">
                                <h4 class="text-lg font-semibold mb-4 text-[var(--text-primary)]">Share this article:</h4>
                                <div class="flex gap-4">
                                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ site.url }}{{ site.baseurl }}{{ page.url }}" 
                                       class="px-4 py-2 rounded font-semibold transition duration-300 text-gray-800 border border-gray-300" 
                                       style="background-color: #fce8e8;"
                                       target="_blank">
                                        <i class="fab fa-facebook-f mr-2" style="color: #DC2626;"></i>Facebook
                                    </a>
                                    <a href="https://www.instagram.com/" 
                                       class="px-4 py-2 rounded font-semibold transition duration-300 text-gray-800 border border-gray-300" 
                                       style="background-color: #fce8e8;"
                                       target="_blank">
                                        <i class="fab fa-instagram mr-2" style="color: #DC2626;"></i>Instagram
                                    </a>
                                    <a href="https://www.tiktok.com/" 
                                       class="px-4 py-2 rounded font-semibold transition duration-300 text-gray-800 border border-gray-300" 
                                       style="background-color: #fce8e8;"
                                       target="_blank">
                                        <i class="fab fa-tiktok mr-2" style="color: #DC2626;"></i>TikTok
                                    </a>
                                </div>
                            </div>
                        </article>
                        
                        <!-- Right Sidebar -->
                        <aside class="lg:w-1/3 desktop-sidebar">
                            <!-- Contact CTA - FIXED VERSION -->
                            <div class="bg-gray-800 p-6 rounded-lg mb-6">
                                <h3 class="text-white text-lg font-bold mb-4">Need Help?</h3>
                                
                                <div class="space-y-3">
                                    <!-- Speak to an Expert Button -->
                                    <a href="tel:{{ site.contact.phone }}" 
                                       class="flex items-center justify-center w-full py-3 px-4 bg-white text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition duration-200">
                                        <i class="fas fa-phone mr-2 text-red-600"></i>
                                        Speak to an Expert
                                    </a>
                                    
                                    <!-- Request a Callback Button -->
                                    <button onclick="openSupportModal()" 
                                            class="flex items-center justify-center w-full py-3 px-4 bg-white text-gray-800 font-semibold rounded-lg hover:bg-gray-100 transition duration-200">
                                        <i class="fas fa-comments mr-2 text-red-600"></i>
                                        Request a Callback
                                    </button>
                                </div>
                                
                                <p class="text-gray-300 text-sm mt-4 text-center">
                                    Get expert loan advice in minutes
                                </p>
                            </div>
                            
                            <!-- Related Posts - RANDOMIZED 4-5 POSTS -->
                            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg mb-6 transition-colors duration-300">
                                <h3 class="text-xl font-bold mb-4 text-[var(--text-primary)]">You Might Also Like</h3>
                                {% assign shuffled_posts = site.posts | sample: 5 %}
                                {% for post in shuffled_posts %}
                                    {% unless post.url == page.url %}
                                    <div class="mb-4 pb-4 {% unless forloop.last %}border-b border-gray-200{% endunless %}">
                                        <h4 class="font-semibold text-[var(--text-primary)] hover:text-red-600 transition duration-300">
                                            <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
                                        </h4>
                                        <p class="text-sm text-[var(--text-secondary)] mt-1">{{ post.date | date: "%B %d, %Y" }}</p>
                                        {% if post.excerpt %}
                                        <p class="text-sm text-[var(--text-secondary)] mt-1">{{ post.excerpt | strip_html | truncatewords: 15 }}</p>
                                        {% endif %}
                                    </div>
                                    {% endunless %}
                                {% endfor %}
                                
                                <div class="mt-6">
                                    <a href="{{ site.baseurl }}/blog/" class="text-red-600 font-semibold hover:text-red-800">
                                        <i class="fas fa-arrow-left mr-2"></i>
                                        Back to All Posts
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Recent Posts -->
                            <div class="bg-[var(--bg-secondary)] p-6 rounded-lg transition-colors duration-300">
                                <h3 class="text-xl font-bold mb-4 text-[var(--text-primary)]">Recent Posts</h3>
                                {% assign recent_posts = site.posts | limit: 5 %}
                                {% for post in recent_posts %}
                                    {% unless post.url == page.url %}
                                    <div class="mb-4 pb-4 {% unless forloop.last %}border-b border-gray-200{% endunless %}">
                                        <h4 class="font-semibold text-[var(--text-primary)] hover:text-red-600 transition duration-300">
                                            <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
                                        </h4>
                                        <p class="text-sm text-[var(--text-secondary)] mt-1">{{ post.date | date: "%B %d, %Y" }}</p>
                                    </div>
                                    {% endunless %}
                                {% endfor %}
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Related Posts -->
        {% assign related_posts = site.posts | where: "category", page.category | limit: 3 %}
        {% if related_posts.size > 1 %}
        <section class="py-16 bg-[var(--bg-secondary)] transition-colors duration-300">
            <div class="container mx-auto px-6">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-12 text-[var(--text-primary)]">Related Articles</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for post in related_posts %}
                            {% unless post.url == page.url %}
                            <div class="bg-[var(--bg-primary)] rounded-lg shadow-md overflow-hidden transition-colors duration-300">
                                {% if post.featured_image %}
                                <img src="{{ site.baseurl }}/assets/images/blog/{{ post.featured_image }}" alt="{{ post.title }}" class="w-full h-48 object-cover">
                                {% else %}
                                <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                                    <i class="fas fa-{{ post.icon | default: 'newspaper' }} text-4xl text-gray-400"></i>
                                </div>
                                {% endif %}
                                <div class="p-6">
                                    <h3 class="text-xl font-bold mb-2 text-[var(--text-primary)]">{{ post.title }}</h3>
                                    <p class="text-[var(--text-secondary)] mb-4">{{ post.excerpt | strip_html | truncatewords: 20 }}</p>
                                    <a href="{{ site.baseurl }}{{ post.url }}" class="font-semibold text-red-600 hover:text-red-800">
                                        Read More &rarr;
                                    </a>
                                </div>
                            </div>
                            {% endunless %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
    </main>
    
    <!-- Footer -->
    {% include footer.html %}
    
    <!-- Back to Top Button -->
    <button id="back-to-top" class="bg-brand-red text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <!-- FIXED: Complete JavaScript with dark mode support -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Dark mode functionality (copied from working default.html)
            const themeToggles = document.querySelectorAll('#theme-toggle-desktop, #theme-toggle-mobile');
            const htmlEl = document.documentElement;
            const currentTheme = localStorage.getItem('theme') || 'light';
            
            const updateIcon = (theme) => { 
                themeToggles.forEach(toggle => { 
                    toggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>'; 
                }); 
            }
            
            htmlEl.classList.add(currentTheme);
            updateIcon(currentTheme);
            
            themeToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    if (htmlEl.classList.contains('dark')) {
                        htmlEl.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                        updateIcon('light');
                    } else {
                        htmlEl.classList.add('dark');
                        localStorage.setItem('theme', 'dark');
                        updateIcon('dark');
                    }
                });
            });
            
            // Back to top functionality
            const backToTopButton = document.getElementById('back-to-top');
            if(backToTopButton){
                window.addEventListener('scroll', () => { 
                    if (window.scrollY > 300) { 
                        backToTopButton.classList.add('active'); 
                    } else { 
                        backToTopButton.classList.remove('active'); 
                    } 
                });
                backToTopButton.addEventListener('click', () => { 
                    window.scrollTo({ top: 0, behavior: 'smooth' }); 
                });
            }
            
            // Support modal functionality
            window.openSupportModal = function() {
                const modal = document.getElementById('support-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            };
            
            window.closeSupportModal = function() {
                const modal = document.getElementById('support-modal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            };
            
            // Close modal when clicking outside or ESC
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('support-modal');
                if (event.target === modal) {
                    closeSupportModal();
                }
            });

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeSupportModal();
                }
            });
        });
    </script>
</body>
</html>
