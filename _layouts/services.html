<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>{{ page.title | default: site.seo.default_title }}</title>
    <meta name="description" content="{{ page.meta_description | default: site.seo.default_description }}">
    <meta name="keywords" content="{{ page.meta_keywords | default: site.seo.default_keywords }}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{ page.title | default: site.seo.default_title }}">
    <meta property="og:description" content="{{ page.meta_description | default: site.seo.default_description }}">
    <meta property="og:type" content="{{ page.og_type | default: 'website' }}">
    <meta property="og:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta property="og:image" content="{{ site.url }}{{ site.baseurl }}{{ page.hero_image | default: site.seo.fallback_image }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page.title | default: site.seo.default_title }}">
    <meta name="twitter:description" content="{{ page.meta_description | default: site.seo.default_description }}">
    <meta name="twitter:image" content="{{ site.url }}{{ site.baseurl }}{{ page.hero_image | default: site.seo.fallback_image }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicon.ico">
    
    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FIXED: Complete Dark Mode CSS - Based on Working default.html Pattern -->
    <style>
        :root { 
            --bg-primary: #ffffff; 
            --bg-secondary: #f9fafb; 
            --bg-accent: #fce8e8; 
            --text-primary: #1f2937; 
            --text-secondary: #4b5563; 
            --brand-red: #DC2626; 
            --brand-red-dark: #B91C1C; 
        }
        html.dark { 
            --bg-primary: #1f2937; 
            --bg-secondary: #374151; 
            --bg-accent: #374151; 
            --text-primary: #f9fafb; 
            --text-secondary: #d1d5db; 
        }
        
        /* FIXED: Dark mode contrast issues - Complete set from working default.html */
        html.dark .features-heading, 
        html.dark .features-benefits-section h3,
        html.dark .privacy-content h2,
        html.dark .privacy-content h3,
        html.dark h1,
        html.dark h2, 
        html.dark h3,
        html.dark h4,
        html.dark h5,
        html.dark h6 { 
            color: #ffffff !important; 
        }
        
        /* FIXED: Dark mode text colors */
        html.dark .text-gray-800 {
            color: #f9fafb !important;
        }
        
        html.dark .text-gray-700 {
            color: #d1d5db !important;
        }
        
        html.dark .text-gray-600 {
            color: #9ca3af !important;
        }
        
        /* FIXED: Dark mode backgrounds */
        html.dark .bg-white {
            background-color: #374151 !important;
        }
        
        html.dark .bg-gray-50 {
            background-color: #4b5563 !important;
        }
        
        /* Keep brand red visible in dark mode */
        html.dark .brand-red {
            color: #ef4444 !important;
        }
        
        /* CRITICAL FIX: Pink sections ALWAYS stay light with dark text */
        html.dark .service-header,
        html.dark [style*="background-color: #fce8e8"],
        html.dark .bg-red-50,
        html.dark .bg-\\[var\\(--bg-accent\\)\\] {
            background-color: #fce8e8 !important;
            color: #374151 !important;
        }
        
        html.dark .service-header *,
        html.dark [style*="background-color: #fce8e8"] *,
        html.dark .bg-red-50 *,
        html.dark .bg-\\[var\\(--bg-accent\\)\\] * {
            color: #374151 !important;
        }
        
        /* FIXED: Header stays same in both light and dark mode */
        html.dark header {
            background-color: white !important;
        }
        
        html.dark header nav a {
            color: #4b5563 !important;
        }
        
        html.dark header .text-gray-700 {
            color: #4b5563 !important;
        }
        
        html.dark header button[style*="border-color: #fce8e8"] {
            border-color: #fce8e8 !important;
            color: #4b5563 !important;
        }
        
        body { 
            font-family: 'Open Sans', sans-serif; 
            background-color: var(--bg-primary); 
            color: var(--text-primary); 
            transition: background-color 0.3s, color 0.3s; 
        }
        h1, h2, h3, h4, h5, h6 { 
            font-family: 'Poppins', sans-serif; 
            color: var(--text-primary);
        }
        .brand-red { 
            color: var(--brand-red) !important; 
        }
        .bg-brand-red { 
            background-color: var(--brand-red) !important; 
        }
        .hover\:bg-brand-red-dark:hover { 
            background-color: var(--brand-red-dark) !important; 
        }
        #back-to-top { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            opacity: 0; 
            visibility: hidden; 
            transform: translateY(20px); 
            transition: all 0.3s; 
            z-index: 100; 
        }
        #back-to-top.active { 
            opacity: 1; 
            visibility: visible; 
            transform: translateY(0); 
        }
        .animate-on-scroll { 
            opacity: 0; 
            transform: translateY(20px); 
            transition: opacity 0.6s ease-out, transform 0.6s ease-out; 
        }
        .animate-on-scroll.is-visible { 
            opacity: 1; 
            transform: translateY(0); 
        }
        .delay-1 { transition-delay: 0.1s; } 
        .delay-2 { transition-delay: 0.2s; } 
        .delay-3 { transition-delay: 0.3s; }
        .mobile-nav { display: none; } 
        .mobile-nav.active { display: flex; }
        @media (max-width: 768px) { 
            .desktop-nav { display: none; } 
        }
    </style>
</head>
<body class="bg-white text-gray-800">

    <!-- Header -->
    {% include header.html %}
    
    <main>
        {% if page.service_type %}
        <!-- Hero Section - FIXED: Using bg-[var(--bg-accent)] pattern -->
        <section class="bg-[var(--bg-accent)] transition-colors duration-300 service-header">
            <div class="container mx-auto px-6 py-16 grid md:grid-cols-2 gap-12 items-center">
                <div class="animate-on-scroll">
                    <h1 class="text-5xl font-extrabold text-[var(--text-primary)] mb-4">
                        {% assign title_clean = page.title | remove: ' | The Loan Phone' %}
                        {% if page.hero_highlight %}
                            {% assign highlighted_title = title_clean | replace: page.hero_highlight, '<span class="brand-red">' | append: page.hero_highlight | append: '</span>' %}
                            {{ highlighted_title }}
                        {% else %}
                            {{ title_clean }}
                        {% endif %}
                    </h1>
                    
                    {% if page.subtitle %}
                    <p class="text-xl text-[var(--text-secondary)] mb-6">{{ page.subtitle }}</p>
                    {% endif %}
                    
                    {% if page.excerpt %}
                    <p class="text-xl text-[var(--text-secondary)] mb-6">{{ page.excerpt }}</p>
                    {% endif %}
                    
                    <a href="{{ site.baseurl }}/#loan-selector" class="inline-block text-gray-800 font-bold text-lg px-8 py-4 rounded-lg shadow-xl hover:opacity-80 transition duration-300" style="background-color: #fce8e8;">
                        Start Your Comparison
                    </a>
                </div>
                <div class="animate-on-scroll delay-1">
                    {% if page.hero_image %}
                    <img src="{{ site.baseurl }}/assets/images/hero/{{ page.hero_image }}" alt="{{ page.title | remove: ' | The Loan Phone' }} illustration" class="rounded-lg shadow-2xl w-full h-auto aspect-square object-cover">
                    {% else %}
                    <div class="rounded-lg shadow-2xl w-full aspect-square bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-{{ page.icon | default: 'handshake' }} text-6xl text-gray-400"></i>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <!-- Features & Benefits Section -->
        <section class="py-20 bg-[var(--bg-primary)] transition-colors duration-300 features-benefits-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 animate-on-scroll">
                    <h2 class="text-3xl font-bold features-heading text-[var(--text-primary)]">
                        {% if page.features_title %}
                            {{ page.features_title }}
                        {% else %}
                            The Smarter Way to {{ page.service_type | default: "Get Your Loan" }}
                        {% endif %}
                    </h2>
                    <p class="mt-2 text-lg text-[var(--text-secondary)]">Discover the features and benefits of using Loan Phone.</p>
                </div>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {% if page.key_benefits %}
                        {% for benefit in page.key_benefits %}
                        <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-{{ forloop.index | modulo: 3 | plus: 1 }} transition-colors duration-300">
                            {% if benefit.icon %}
                            <i class="{{ benefit.icon }} text-4xl brand-red mb-4"></i>
                            {% endif %}
                            <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">{{ benefit.title }}</h3>
                            <p class="text-[var(--text-secondary)]">{{ benefit.description }}</p>
                        </div>
                        {% endfor %}
                    {% else %}
                    <!-- Default benefits if none specified -->
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-1 transition-colors duration-300">
                        <i class="fas fa-search text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Compare Multiple Lenders</h3>
                        <p class="text-[var(--text-secondary)]">We give you access to a wide range of lenders to ensure you get a competitive rate and term.</p>
                    </div>
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-2 transition-colors duration-300">
                        <i class="fas fa-tachometer-alt text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Fast Approvals</h3>
                        <p class="text-[var(--text-secondary)]">Our streamlined process is designed to get you a fast pre-approval so you can secure your loan quickly.</p>
                    </div>
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-3 transition-colors duration-300">
                        <i class="fas fa-shield-alt text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Protect Your Credit File</h3>
                        <p class="text-[var(--text-secondary)]">See your genuine finance options without lodging a formal application that impacts your credit score.</p>
                    </div>
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-1 transition-colors duration-300">
                        <i class="fas fa-user-tie text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Expert Guidance</h3>
                        <p class="text-[var(--text-secondary)]">Get paired with a specialist broker who knows the market and can structure a deal that suits your needs.</p>
                    </div>
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-2 transition-colors duration-300">
                        <i class="fas fa-file-invoice text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Flexible Options</h3>
                        <p class="text-[var(--text-secondary)]">We work with lenders who offer flexible documentation and approval options for various situations.</p>
                    </div>
                    <div class="bg-[var(--bg-secondary)] p-6 rounded-lg shadow-md animate-on-scroll delay-3 transition-colors duration-300">
                        <i class="fas fa-handshake text-4xl brand-red mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-[var(--text-primary)]">Personalized Service</h3>
                        <p class="text-[var(--text-secondary)]">Our team provides personalized service to ensure you get the best loan solution for your specific circumstances.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <!-- Service Content Section -->
        <section class="py-16 bg-[var(--bg-primary)] transition-colors duration-300">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto">
                    <article class="text-[var(--text-primary)]">
                        {{ content }}
                    </article>
                </div>
            </div>
        </section>

        {% else %}
        <!-- Services Index Page Layout -->
        <div class="bg-[var(--bg-primary)] transition-colors duration-300">
            {{ content }}
        </div>
        {% endif %}
    </main>
    
    <!-- Footer -->
    {% include footer.html %}
    
    <!-- Back to Top Button -->
    <button id="back-to-top" class="text-gray-800 w-12 h-12 rounded-full shadow-lg flex items-center justify-center" style="background-color: #fce8e8;">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <!-- FIXED: Complete JavaScript with dark mode support -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Dark mode functionality (copied from working default.html)
            const themeToggles = document.querySelectorAll('#theme-toggle-desktop, #theme-toggle-mobile');
            const htmlEl = document.documentElement;
            const currentTheme = localStorage.getItem('theme') || 'light';
            
            const updateIcon = (theme) => { 
                themeToggles.forEach(toggle => { 
                    toggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>'; 
                }); 
            }
            
            htmlEl.classList.add(currentTheme);
            updateIcon(currentTheme);
            
            themeToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    if (htmlEl.classList.contains('dark')) {
                        htmlEl.classList.remove('dark');
                        localStorage.setItem('theme', 'light');
                        updateIcon('light');
                    } else {
                        htmlEl.classList.add('dark');
                        localStorage.setItem('theme', 'dark');
                        updateIcon('dark');
                    }
                });
            });
            
            // Back to top functionality
            const backToTopButton = document.getElementById('back-to-top');
            if(backToTopButton){
                window.addEventListener('scroll', () => { 
                    if (window.scrollY > 300) { 
                        backToTopButton.classList.add('active'); 
                    } else { 
                        backToTopButton.classList.remove('active'); 
                    } 
                });
                backToTopButton.addEventListener('click', () => { 
                    window.scrollTo({ top: 0, behavior: 'smooth' }); 
                });
            }
            
            // Scroll animations
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { 
                    if (entry.isIntersecting) { 
                        entry.target.classList.add('is-visible'); 
                    } 
                });
            }, { threshold: 0.1 });
            
            const elementsToAnimate = document.querySelectorAll('.animate-on-scroll');
            elementsToAnimate.forEach(el => observer.observe(el));
            
            // Support modal functionality
            window.openSupportModal = function() {
                const modal = document.getElementById('support-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            };
            
            window.closeSupportModal = function() {
                const modal = document.getElementById('support-modal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            };
            
            // Close modal when clicking outside or ESC
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('support-modal');
                if (event.target === modal) {
                    closeSupportModal();
                }
            });

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeSupportModal();
                }
            });
        });
    </script>
</body>
</html>
