<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>{% if page.title %}{{ page.title }}{% else %}{{ site.seo.default_title }}{% endif %}</title>
    <meta name="description" content="{% if page.meta_description %}{{ page.meta_description }}{% else %}{{ site.seo.default_description }}{% endif %}">
    <meta name="keywords" content="{% if page.meta_keywords %}{{ page.meta_keywords }}{% else %}{{ site.seo.default_keywords }}{% endif %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% if page.og_type %}{{ page.og_type }}{% else %}website{% endif %}">
    <meta property="og:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.seo.default_title }}{% endif %}">
    <meta property="og:description" content="{% if page.meta_description %}{{ page.meta_description }}{% else %}{{ site.seo.default_description }}{% endif %}">
    <meta property="og:image" content="{% if page.featured_image %}{{ site.url }}{{ site.baseurl }}/assets/images/{{ page.featured_image }}{% else %}{{ site.url }}{{ site.baseurl }}{{ site.seo.fallback_image }}{% endif %}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta property="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.seo.default_title }}{% endif %}">
    <meta property="twitter:description" content="{% if page.meta_description %}{{ page.meta_description }}{% else %}{{ site.seo.default_description }}{% endif %}">
    <meta property="twitter:image" content="{% if page.featured_image %}{{ site.url }}{{ site.baseurl }}/assets/images/{{ page.featured_image }}{% else %}{{ site.url }}{{ site.baseurl }}{{ site.seo.fallback_image }}{% endif %}">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/assets/images/favicon.ico">
    
    <!-- CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Widget CSS (if live) -->
    {% if site.features.loan_widget_live %}
        <link rel="stylesheet" href="{{ site.features.widget_css }}">
    {% endif %}

    <style>
        :root {
            --primary-red: #DC2626 !important;
            --dark-red: #B91C1C !important;
            --light-red: #FEE2E2 !important;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
        }
        
        .text-primary-red {
            color: var(--primary-red) !important;
        }
        
        .bg-primary-red {
            background-color: var(--primary-red) !important;
        }
        
        .border-primary-red {
            border-color: var(--primary-red) !important;
        }
        
        .hover\:bg-primary-red:hover {
            background-color: var(--primary-red) !important;
        }

        /* Dark mode styles */
        .dark {
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        
        .dark .bg-white {
            background-color: #2d2d2d !important;
        }
        
        .dark .text-gray-900 {
            color: #e5e5e5 !important;
        }
        
        .dark .text-gray-700 {
            color: #d1d5db !important;
        }
        
        .dark .text-gray-600 {
            color: #9ca3af !important;
        }
        
        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }
        
        .dark .bg-gray-50 {
            background-color: #374151 !important;
        }
        
        .dark .bg-gray-100 {
            background-color: #4b5563 !important;
        }

        /* Animation utilities */
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.8s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    {% include header.html %}
    
    <!-- Main Content -->
    <main>
        {{ content }}
    </main>
    
    <!-- Footer -->
    {% include footer.html %}

    <!-- JavaScript -->
    <script>
        // Dark Mode Toggle
        function toggleDarkMode() {
            const body = document.body;
            const isDark = body.classList.contains('dark');
            
            if (isDark) {
                body.classList.remove('dark');
                localStorage.setItem('darkMode', 'false');
            } else {
                body.classList.add('dark');
                localStorage.setItem('darkMode', 'true');
            }
        }

        // Initialize dark mode from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.body.classList.add('dark');
            }
        });

        // Smooth scroll for anchor links
        document.addEventListener('DOMContentLoaded', function() {
            const anchorLinks = document.querySelectorAll('a[href^="#"]');
            
            anchorLinks.forEach(function(link) {
                link.addEventListener('click', function(e) {
                    const targetId = this.getAttribute('href');
                    
                    // Don't interfere with modal triggers
                    if (targetId === '#' || this.onclick) {
                        return;
                    }
                    
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        e.preventDefault();
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });

        // Back to top functionality
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Show/hide back to top button
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('back-to-top');
            if (backToTop) {
                if (window.pageYOffset > 300) {
                    backToTop.style.display = 'block';
                } else {
                    backToTop.style.display = 'none';
                }
            }
        });

        // Intersection Observer for animations
        document.addEventListener('DOMContentLoaded', function() {
            const animatedElements = document.querySelectorAll('[data-animate]');
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const animation = element.getAttribute('data-animate');
                        element.classList.add(animation);
                        observer.unobserve(element);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });
            
            animatedElements.forEach(function(element) {
                observer.observe(element);
            });
        });

        // *** MODAL FUNCTIONS - ADDED FOR SUPPORT POPUP ***
        window.openSupportModal = function() {
            const modal = document.getElementById('support-modal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        };

        window.closeSupportModal = function() {
            const modal = document.getElementById('support-modal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };

        // Close modal when clicking outside or ESC
        window.onclick = function(event) {
            const modal = document.getElementById('support-modal');
            if (event.target === modal) closeSupportModal();
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') closeSupportModal();
        });
    </script>

    <!-- Widget JavaScript (if live) -->
    {% if site.features.loan_widget_live %}
        <script src="{{ site.features.widget_js }}"></script>
        <script>
            // Initialize widget when DOM is ready
            document.addEventListener('DOMContentLoaded', function() {
                if (typeof LoanOptionsWidget !== 'undefined') {
                    LoanOptionsWidget.init({
                        partnerId: '{{ site.features.partner_id }}',
                        sourceUrl: '{{ site.features.source_url }}',
                        container: '#loan-widget-container'
                    });
                }
            });
        </script>
    {% endif %}

    <!-- Development only validation -->
    {% unless jekyll.environment == "production" %}
        {% include content-validation.html %}
        {% include site-health.html %}
    {% endunless %}
</body>
</html>
